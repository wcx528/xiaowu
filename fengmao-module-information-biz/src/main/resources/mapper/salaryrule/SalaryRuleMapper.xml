<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fmyd888.fengmao.module.information.dal.mysql.salaryrule.SalaryRuleMapper">

    <!--
        一般情况下，尽可能使用 Mapper 进行 CRUD 增删改查即可。
        无法满足的场景，例如说多表关联查询，才使用 XML 编写 SQL。
        代码生成器暂时只生成 Mapper XML 文件本身，更多推荐 MybatisX 快速开发插件来生成查询。
     -->

    <select id="selectByPage"
            resultType="com.fmyd888.fengmao.module.information.controller.admin.salaryRule.vo.SalaryRuleRespVO">
        SELECT
        t1.id,
        t1.position,
        t1.basic_salary,
        t1.attendance_award,
        t1.position_subsidy,
        t1.structural_subsidy,
        t1.other,
        t1.salary_total,
        t1.grade,
        t1.grade_standard,
        t1.annual_salary,
        t1.remark,
        t1.create_time,
        t1.update_time,
        t1.creator,
        t1.updater
        FROM fm_salary_rule t1
        LEFT JOIN fm_salary_rule_dept t2 ON t1.id = t2.entity_id AND t2.deleted = 0
        <where>
            t1.deleted = 0
            <if test="pageReqVO.keyword != null and pageReqVO.keyword != ''">
            CONCAT(
            t1.position, ' ' ,
            t1.basic_salary, ' ' ,
            t1.attendance_award, ' ' ,
            t1.position_subsidy, ' ' ,
            t1.structural_subsidy, ' ' ,
            t1.other, ' ' ,
            t1.salary_total, ' ' ,
            t1.grade, ' ' ,
            t1.grade_standard, ' ' ,
            t1.annual_salary, ' ' ,
            t1.remark, ' ' ,
            t1.creator, ' ' ,
            t1.updater, ' ' ,
            t2.name
            ) LIKE '%' + #{pageReqVO.keyword} + '%' COLLATE Chinese_PRC_CI_AS
            </if>
            <if test="pageReqVO.deptId != null and pageReqVO.deptId != ''">
                AND t2.dept_id = #{pageReqVO.deptId}
            </if>
            <if test="pageReqVO.position != null and pageReqVO.position != ''">
                AND t1.position = #{pageReqVO.position}
            </if>
            <if test="pageReqVO.createTime != null and pageReqVO.createTime.size() > 0">
                and t1.create_time BETWEEN
                <foreach collection="pageReqVO.createTime" item="createTime" separator=" AND ">
                    #{createTime}
                </foreach>
            </if>
            <if test="pageReqVO.grade != null and pageReqVO.grade != ''">
                AND t1.grade = #{pageReqVO.grade}
            </if>
        </where>
        GROUP BY t1.id,
        t1.position,
        t1.basic_salary,
        t1.attendance_award,
        t1.position_subsidy,
        t1.structural_subsidy,
        t1.other,
        t1.salary_total,
        t1.grade,
        t1.grade_standard,
        t1.annual_salary,
        t1.remark,
        t1.create_time,
        t1.update_time,
        t1.creator,
        t1.updater
    </select>
</mapper>